<% layout('layouts/managerBoilerplate') %>
<% pageName = 'showEmployee' %>

<body>
   
    <!-- Employee Profile Section -->
    <section class="profile-section py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <!-- Profile Header Card -->
                    <div class="profile-header-card fade-in-up mb-4" style="margin-top:100px;">
                        <div class="profile-bg"></div>
                        <div class="row align-items-center">
                            <div class="col-lg-4 text-center">
                                <div class="profile-photo-container">
                                    <div class="photo-glow"></div>
                                    <img src="<%= employee.photo.url %>" alt="<%= employee.username %> photo"
                                        class="profile-photo" id="employeePhoto">
                                   <div div class="status-indicator <%= employee.isActive ? 'online' : 'offline' %>"></div>
                                </div>
                                <div class="profile-actions mt-4">
                                    <button class="btn btn-primary btn-md me-2" onclick="openUpdatePopup()">
                                        <i class="fas fa-edit me-2"></i>Update Profile
                                    </button>
                                    <button class="btn btn-danger btn-md" onclick="confirmDelete()">
                                        <i class="fas fa-trash me-2"></i>Delete
                                    </button>
                                </div>
                            </div>
                            <div class="col-lg-8">
                                <div class="profile-info">
                                    <h2 class="employee-name" id="employeeName">
                                        <%= employee.username %>
                                    </h2>
                                    <p class="employee-role" id="employeeRole">
                                        <%= employee.role %>
                                    </p>
                                    <!-- <div class="employee-rating mb-3">
                                    <div class="rating-stars">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star-half-alt"></i>
                                    </div>
                                    <span class="rating-text ms-2">4.8 Rating</span>
                                </div> -->
                                    <div class="employee-stats">
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fa-solid fa-users-gear"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-value">
                                                    <%= employee.managerID.username %>
                                                </div>
                                                <div class="stat-label">Managed By</div>
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-trophy"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-value">Top Performer</div>
                                                <div class="stat-label">Achievement</div>
                                            </div>
                                        </div>
                                        <div class="stat-item">
                                            <div class="stat-icon">
                                                <i class="fas fa-clock"></i>
                                            </div>
                                            <div class="stat-info">
                                                <div class="stat-value">
                                                    <%= employee.isActive ? 'Active' : 'Inactive' %>
                                                </div>
                                                <div class="stat-label">Status</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Details Grid -->
                    <div class="row">
                        <!-- Contact Information -->
                        <div class="col-lg-6 mb-4">
                            <div class="detail-card fade-in-up">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-address-card"></i>
                                    </div>
                                    <h4>Contact Information</h4>
                                </div>
                                <div class="card-content">
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-envelope"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">Email Address</div>
                                            <div class="info-value">
                                                <%= employee.email %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-phone"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">Phone Number</div>
                                            <div class="info-value">+91 <%= employee.phone %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-mobile-alt"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">UPI ID</div>
                                            <div class="info-value">
                                                <%= employee.upiID %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Hotel Information -->
                        <div class="col-lg-6 mb-4">
                            <div class="detail-card fade-in-up">
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <h4>Hotel Information</h4>
                                </div>
                                <div class="card-content">
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-hotel"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">Hotel Name</div>
                                            <div class="info-value">
                                                <%= employee.hotelID.name %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-map-marker-alt"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">Location</div>
                                            <div class="info-value">
                                                <%= employee.hotelID.locationID.address %>, <%=
                                                        employee.hotelID.locationID.city %>,<%=
                                                            employee.hotelID.locationID.state %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="info-item">
                                        <div class="info-icon">
                                            <i class="fas fa-user-tag"></i>
                                        </div>
                                        <div class="info-details">
                                            <div class="info-label">Manager </div>
                                            <div class="info-value">
                                                <%= employee.managerID.username %>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                   
                </div>
            </div>
        </div>
    </section>


    <!-- Update Employee Modal -->
    <div class="modal fade" id="updateEmployeeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <form method="POST" action="/employee/<%= employee._id %>?_method=PUT" enctype="multipart/form-data"
                id="updateEmployeeForm" class="needs-validation" novalidate>
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-user-edit me-2"></i>Update Employee Details
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">

                        <div class="text-center mb-4">
                            <div class="current-photo-preview position-relative">
                              <% try { %>
                                <% if (employee && employee.photo && employee.photo.url) { %>
                                  <img id="currentPhotoPreview"
                                       src="<%= employee.photo.url %>"
                                       alt="<%= employee.username || 'User' %>"
                                       class="preview-image"
                                       onerror="this.src='/images/default.png'">
                                <% } else { %>
                                  <img id="currentPhotoPreview"
                                       src="/images/default.png"
                                       alt="Default user"
                                       class="preview-image">
                                <% } %>
                              <% } catch (e) { %>
                                <img id="currentPhotoPreview"
                                     src="/images/default.png"
                                     alt="Default user"
                                     class="preview-image">
                              <% } %>
                          
                              <div class="photo-overlay">
                                <i class="fas fa-camera"></i>
                              </div>
                            </div>
                          </div>
                          

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" name="email" id="updateEmail"
                                        value="<%= typeof employee !== 'undefined' ? employee.email || '' : '' %>"
                                        required>
                                    <label for="updateEmail">Email Address</label>
                                    <div class="invalid-feedback">Please provide a valid email.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" name="username" id="updateUsername"
                                        value="<%= typeof employee !== 'undefined' ? employee.username || '' : '' %>"
                                        required>
                                    <label for="updateUsername">Full Name</label>
                                    <div class="invalid-feedback">Please provide a valid name.</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="tel" class="form-control" name="phone" id="updatePhone"
                                        value="<%= typeof employee !== 'undefined' ? employee.phone || '' : '' %>"
                                        required required>
                                    <label for="updatePhone">Phone Number</label>
                                    <div class="invalid-feedback">Please provide a valid phone number.</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="updateRole" name="role" required>
                                        <option value="">Select Role</option>
                                        <option value="waiter" <%=(typeof employee !=='undefined' &&
                                            employee.role==='waiter' ) ? 'selected' : '' %>>Waiter</option>
                                        <option value="chef" <%=(typeof employee !=='undefined' &&
                                            employee.role==='chef' ) ? 'selected' : '' %>>Chef</option>
                                        <option value="receptionist" <%=(typeof employee !=='undefined' &&
                                            employee.role==='receptionist' ) ? 'selected' : '' %>>Receptionist</option>
                                        <option value="housekeeping" <%=(typeof employee !=='undefined' &&
                                            employee.role==='housekeeping' ) ? 'selected' : '' %>>Housekeeping</option>
                                        <option value="manager" <%=(typeof employee !=='undefined' &&
                                            employee.role==='manager' ) ? 'selected' : '' %>>Manager</option>
                                        <option value="bartender" <%=(typeof employee !=='undefined' &&
                                            employee.role==='bartender' ) ? 'selected' : '' %>>Bartender</option>
                                        <option value="other" <%=(typeof employee !=='undefined' &&
                                            employee.role==='other' ) ? 'selected' : '' %>>Other</option>
                                    </select>
                                    <label for="updateRole">Role</label>
                                    <div class="invalid-feedback">Please select a role.</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" name="upiID" id="updateUpiID"
                                        value="<%= typeof employee !== 'undefined' ? employee.upiID || '' : '' %>">
                                    <label for="updateUpiID">UPI ID</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="updateIsActive" name="isActive">
                                        <option value="true" <%=typeof employee !=='undefined' &&
                                            employee.isActive===true ? 'selected' : '' %>>Active</option>
                                        <option value="false" <%=typeof employee !=='undefined' &&
                                            employee.isActive===false ? 'selected' : '' %>>Inactive</option>
                                    </select>
                                    <label for="updateIsActive">Status</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="updatePhoto" class="form-label">Profile Photo</label>
                            <input type="file" class="form-control" id="updatePhoto" name="photo" accept="image/*">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" onclick="updateEmployee()">
                            <i class="fas fa-save me-2"></i>Update Employee
                        </button>
                    </div>
                </div>
            </form>

        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirm Deletion
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this employee? This action cannot be undone.</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle me-2"></i>
                        All associated data of this employee will be permanently removed.
                    </div>
                </div>



                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <form action="/employee/<%= employee._id %>?_method=DELETE" method="POST">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Delete Employee
                        </button>
                    </form>
                </div>



            </div>
        </div>
    </div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/showHotel.js"></script>

</body>

</html>